<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="來看瀏覽器跟資料庫是怎麼用程式溝通的吧！"><title>AJAX 在程式上怎麼運作？</title>
<link rel=canonical href=https://revolc.blog/posts/ajax-code-example/><link rel="shortcut icon" href=/revolc-font-logo.jpeg><link rel=icon type=image/jpeg href=/revolc-font-logo.jpeg><link rel=icon type=image/jpeg sizes=32x32 href=/revolc-font-logo.jpeg><link rel=icon type=image/jpeg sizes=16x16 href=/revolc-font-logo.jpeg><link rel=apple-touch-icon href=/revolc-font-logo.jpeg><link rel=stylesheet href=/scss/style.min.12d03d7e9395d1ae57c5b98158528a59cf2a8829f1496f21e7bf7deb4003f4f3.css><meta property='og:title' content="AJAX 在程式上怎麼運作？"><meta property='og:description' content="來看瀏覽器跟資料庫是怎麼用程式溝通的吧！"><meta property='og:url' content='https://revolc.blog/posts/ajax-code-example/'><meta property='og:site_name' content='RevolC.Blog'><meta property='og:type' content='article'><meta property='article:section' content='Posts'><meta property='article:published_time' content='2024-04-05T00:00:00+00:00'><meta property='article:modified_time' content='2024-04-05T00:00:00+00:00'><meta name=twitter:title content="AJAX 在程式上怎麼運作？"><meta name=twitter:description content="來看瀏覽器跟資料庫是怎麼用程式溝通的吧！"><link rel="shortcut icon" href=/revolc-font-logo.jpeg></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label=切換選單>
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/revolc-font-logo_hu_7ec4294f8e7e0cdb.jpeg width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>RevolC.Blog</a></h1><h2 class=site-description>走走看看這個世界。</h2></div></header><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>首頁</span></a></li><li><a href=/about/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-user-circle"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1018 0A9 9 0 103 12"/><path d="M12 10m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M6.168 18.849A4 4 0 0110 16h4a4 4 0 013.834 2.855"/></svg>
<span>關於我</span></a></li><li class=current><a href=/posts/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>文章</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>搜尋</span></a></li><li><a href=/categories/><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-category"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4h6v6H4z"/><path d="M14 4h6v6h-6z"/><path d="M4 14h6v6H4z"/><path d="M17 17m-3 0a3 3 0 106 0 3 3 0 10-6 0"/></svg>
<span>分類</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>深色模式</span></li></ol></li></ol></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><div class=article-title-wrapper><h2 class=article-content-title>AJAX 在程式上怎麼運作？</h2><h3 class=article-subtitle>來看瀏覽器跟資料庫是怎麼用程式溝通的吧！</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2024/4/5</time></div><div><svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tabler icons-tabler-outline icon-tabler-pencil"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4L18.5 9.5a2.828 2.828.0 10-4-4L4 16v4"/><path d="M13.5 6.5l4 4"/></svg>
<time class=article-time--reading>1919 字</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>閱讀時間：10 分鐘</time></div></footer><header class=article-category><a href=/categories/code/ style=background-color:#6d9489;color:#fff>程式相關</a></header></div></header><section class=article-content><p>上一篇文章，我們講到了 Google 可以在不重新整理頁面的情況下，使用「AJAX」這個技術，同時向資料庫拿取資料，並將這些搜尋建議的資料呈現在畫面上。</p><p>這一篇文章，我會試著用很簡單的方式說明 AJAX 是怎麼在程式上運作的。</p><h2 id=瀏覽器端的程式javascript>瀏覽器端的程式（JavaScript）</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-javascript data-lang=javascript><span class=line><span class=cl><span class=kd>function</span> <span class=nx>searchFunction</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>input</span> <span class=o>=</span> <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;searchBox&#34;</span><span class=p>).</span><span class=nx>value</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>var</span> <span class=nx>xhr</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>XMLHttpRequest</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>open</span><span class=p>(</span><span class=s2>&#34;GET&#34;</span><span class=p>,</span> <span class=s2>&#34;search.php?q=&#34;</span> <span class=o>+</span> <span class=nb>encodeURIComponent</span><span class=p>(</span><span class=nx>input</span><span class=p>),</span> <span class=kc>true</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>onreadystatechange</span> <span class=o>=</span> <span class=kd>function</span> <span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=k>this</span><span class=p>.</span><span class=nx>readyState</span> <span class=o>==</span> <span class=mi>4</span> <span class=o>&amp;&amp;</span> <span class=k>this</span><span class=p>.</span><span class=nx>status</span> <span class=o>==</span> <span class=mi>200</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nb>document</span><span class=p>.</span><span class=nx>getElementById</span><span class=p>(</span><span class=s2>&#34;result&#34;</span><span class=p>).</span><span class=nx>innerHTML</span> <span class=o>=</span> <span class=k>this</span><span class=p>.</span><span class=nx>responseText</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>};</span>
</span></span><span class=line><span class=cl>  <span class=nx>xhr</span><span class=p>.</span><span class=nx>send</span><span class=p>();</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><ul><li><p><code>function searchFunction() {}</code> 代表我創建了一個功能，名字叫做 <code>searchFunction</code>，並把所有功能細項都整理在這裡面。</p></li><li><p>把搜尋欄（searchbox）裡輸入的文字（value）存到 <code>input</code> 裡面。假設我在 <code>searchbox</code> 輸入籃球，那 <code>input</code> 就會是「籃球」。</p></li><li><p>創建一個 <code>XMLHttpRequest</code> 類型的工具物件，這個工具可以用來跟資料庫交換 XML 資料，裡面也包含很多功能跟狀態。而 <code>xhr</code> 是我給這個工具取的代號。</p></li><li><p><code>xhr.open()</code> 是在設定 <code>xhr</code> 物件要跟資料庫講什麼話，讓資料庫知道它是要拿資料，就像我們用中文說「我要拿資料」，程式也有它自己的語言跟溝通方式。</p><ul><li><code>GET</code> 代表我想要跟資料庫拿資料，這應該很好懂。</li><li><code>search.php</code> 是一個資料庫的文件，<code>php</code> 是一個資料庫端運行的程式，同時也是檔名（例如 <code>.doc</code>）。</li><li><code>q</code> 是 <code>query</code>，代表我要查詢，後面的 <code>encodeURIComponent</code> 就是把我剛剛設定的 <code>input</code> 轉成資料庫可以讀取的格式。</li><li>最後的 <code>true</code> 是設定我這個操作要是非同步的。</li><li>總結這一行的解釋：我想要以非同步的方式（true）向資料庫發出一個 <code>GET</code> 的請求，而其中詳細訊息叫做 <code>search.php?q=籃球</code>。意思是我要對資料庫的 <code>search.php</code> 這個檔案，發出一個要查詢（<code>q</code>）籃球這個關鍵字（<code>encodeURIComponent(input)</code>）的訊息。</li></ul></li><li><p><code>xhr.onreadystatechange</code> 是在設定 <code>xhr</code> 這個物件的功能：當資料庫回傳資料成功時，要怎麼顯示到瀏覽器畫面上。</p><ul><li><code>readyState</code> 代表索取資料的狀態，4 代表已經索取成功了，而 <code>status = 200</code> 也是另一種代表索取資料成功的狀態。</li><li>當滿足這兩個條件時，瀏覽器會把我拿到的資料（responseText），呈現在我設定為 <code>result</code> 的地方。</li></ul></li><li><p>把 <code>xhr</code> 的所有功能全部都設置好之後，就使用 <code>xhr.send()</code> 對資料庫正式發送索取資料的訊息。</p><ul><li>為什麼要在正式發送訊息前，就先設定功能？如果先發送再設定功能，有可能會錯過一些狀態變化或資訊。所以為了可以在拿到資料的時候馬上做出反應，會先把所有功能都設定好再正式發送訊息。</li></ul></li></ul><h2 id=資料庫端的程式>資料庫端的程式</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-PHP data-lang=PHP><span class=line><span class=cl><span class=o>&lt;?</span><span class=nx>php</span>
</span></span><span class=line><span class=cl><span class=nv>$query</span> <span class=o>=</span> <span class=nv>$_GET</span><span class=p>[</span><span class=s1>&#39;q&#39;</span><span class=p>];</span>
</span></span><span class=line><span class=cl><span class=nv>$searchSuggestions</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>  <span class=nv>$query</span> <span class=o>.</span> <span class=s2>&#34;直播&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nv>$query</span> <span class=o>.</span> <span class=s2>&#34;規則&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>  <span class=nv>$query</span> <span class=o>.</span> <span class=s2>&#34;訓練&#34;</span>
</span></span><span class=line><span class=cl><span class=p>];</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;您輸入的關鍵字為：&#34;</span> <span class=o>.</span> <span class=nx>htmlspecialchars</span><span class=p>(</span><span class=nv>$query</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>echo</span> <span class=s2>&#34;搜尋建議為：&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=k>foreach</span> <span class=p>(</span><span class=nv>$searchSuggestions</span> <span class=k>as</span> <span class=nv>$suggestion</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=k>echo</span> <span class=nx>htmlspecialchars</span><span class=p>(</span><span class=nv>$suggestion</span><span class=p>)</span> <span class=o>.</span> <span class=s2>&#34;&lt;br&gt;&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=cp>?&gt;</span><span class=err>
</span></span></span></code></pre></div><ul><li>當資料庫收到剛剛的訊息之後，會使用 <code>search.php</code> 這個檔案來執行。</li><li><code>&lt;?php ... ?></code>：這是 PHP 語法的開始和結束標籤。它在告訴資料庫，這裡面的內容應該使用 PHP 來處理。</li><li><code>$_GET['q']</code> 是用來設定我剛剛在瀏覽器端使用 <code>GET</code> 傳遞裡面包含 <code>q</code> 的訊息，也就是籃球。接著我把這個籃球的關鍵字，設定給一個叫做 <code>$query</code> 的參數。</li><li><code>$query . "直播"</code> 裡面的 <code>.</code> 代表把這些單字接在一起，所以 <code>searchSuggestion</code> 會變成：「籃球直播、籃球規則、籃球訓練」。</li><li><code>htmlspecialchars($query)</code> 代表我把「籃球」這個單字包裝成程式能看懂的單字，<code>&lt;br></code> 代表換行，而 <code>echo</code> 代表把這整個句子回傳。所以這行代表：回傳「您輸入的關鍵字為：籃球（換行）」</li><li>下一行 <code>echo "搜尋建議：&lt;br>";</code> 代表：回傳「搜尋建議為：（換行）」</li><li><code>foreach</code> 代表我要使用一個迴圈，以 <code>$suggestion</code> 為索引，從 <code>$searchSuggestions</code> 的第一個項目依序輪到最後一個項目。在這個情況下，<code>$searchSuggestions</code> 有三個項目，所以這個迴圈裡面的程式會進行三次，而每次的 <code>$suggestion</code>依序為「籃球直播、籃球規則、籃球訓練」。</li><li><code>echo htmlspecialchars($suggestion) . "&lt;br>";</code> 會進行三次，代表：回傳「籃球直播（換行）」、回傳「籃球規則（換行）」、回傳「籃球訓練（換行）」。</li></ul><p>所以這整個資料庫端的程式會回傳給瀏覽器的訊息如下：</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=cl>您輸入的關鍵字為：籃球
</span></span><span class=line><span class=cl>搜尋建議為：
</span></span><span class=line><span class=cl>籃球直播
</span></span><span class=line><span class=cl>籃球規則
</span></span><span class=line><span class=cl>籃球訓練
</span></span></code></pre></div><h2 id=最後整理簡化版>最後整理（簡化版）</h2><p>上面我依序解釋了每行程式碼在做什麼事情，可能有點頭暈了。我最後再簡單說明這整個過程到底做了什麼事情。</p><ul><li>我在瀏覽器的搜尋欄位輸入「籃球」。</li><li>瀏覽器創建了一個可以跟資料庫溝通的工具物件。</li><li>設定這個物件的功能：<ul><li>我要跟資料庫說：請回傳給我「籃球」這個字的搜尋建議。</li><li>資料庫回傳搜尋建議回來之後，我要顯示在哪個地方。</li></ul></li><li>物件的功能都設定完之後，正式傳訊息給資料庫。</li><li>資料庫收到訊息之後，根據「籃球」這個關鍵字找到了「籃球直播、籃球規則、籃球訓練」這幾個搜尋建議。</li><li>把這些搜尋建議全部都回傳給瀏覽器。</li><li>瀏覽器收到這些回傳的訊息之後，按照前面設定過的功能，把這些搜尋建議顯示在網頁上。</li></ul><p>對使用者來說，我們輸入關鍵字，網頁上馬上出現搜尋建議，這只有短短不到 0.01 秒的時間。但就在這麼短的時間內，經過了這麼多的步驟。</p><p>希望經過我的說明，讓你對網頁的運作有更進一步的了解！</p></section><footer class=article-footer></footer></article><footer class=site-footer><section class=copyright>&copy;
2024 -
2025 RevolC.Blog</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 建立<br>主題 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.30.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 設計</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>